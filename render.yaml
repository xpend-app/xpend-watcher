services:
    - type: worker
      name: queue-processor
      region: frankfurt
      env: node
      buildCommand: "yarn && yarn build"
      startCommand: "yarn start"
      envVars:
          - key: QUEUE_BROKER_URL
            fromService:
                name: xpend-queue-broker
                type: redis
                property: connectionString
    - type: redis
      name: xpend-queue-broker
      region: frankfurt
      plan: free
      maxmemoryPolicy: noeviction # recommended policy for queues
      ipAllowList: [] # only allow internal connections
    - type: web
      name: xpend
      region: frankfurt
      plan: free
      repo: https://github.com/xpend-app/xpend.git
      env: node
      buildCommand: yarn && yarn build
      startCommand: yarn start:prod
      envVars:
          - key: QUEUE_BROKER_URL
            fromService:
                name: xpend-queue-broker
                type: redis
                property: connectionString
